# pdf dualbookmark with order
def extract_pdf_bookmarks_to_csv(input_pdf,output_csv):
    doc = fitz.open(input_pdf)
    # Return a nested list
    toc = doc.get_toc()  

    # get the max level of bookmarks and generate column label
    max_level = max(item[0] for item in toc) if toc else 0
    columns = [f"level{i+1}" for i in  range(max_level)] + ["order", "page"]

    hierarchy = {level: None for level in range(1, max_level+1)}
    data = []
    counters = {}
    
    for item in toc:
        level = item[0]
        title = item[1]
        page = item[2]

        hierarchy[level] = title

        for l in range(level+1, max_level+1):
            hierarchy[l] = None

        # re - order?
        parent_key = tuple([hierarchy[l] for l in range(1, level) if hierarchy[l] is not None])

        final_seq = None
        if level == max_level:
            if parent_key not in counters:
                counters[parent_key] = 0
            counters[parent_key] += 1
            final_seq = counters[parent_key]

        row = [hierarchy.get(l) for l in range(1, max_level+1)] + [final_seq, page]
        data.append(row)
    
    df = pd.DataFrame(data, columns = columns)
    df = df.dropna(axis=1, how='all')
    
    if(os.path.isfile(output_csv)):
        os.remove(output_csv)
        
    df.to_csv(output_csv, index = False)

extract_pdf_bookmarks_to_csv(input_pdf,output_csv)
